# Author Name:  Robert Terakedis (rterakedis@vmware.com)
# Date:  1/26/2017 
# Minimal/High Level Description:    Custom Attribute Payloads to report various McAfee Endpoint Security/Protection for Mac attributes.  Paste each individual script section into a separate Custom XML payload (do not include the header).
# Tested Version:   AirWatch version 9.0
# Adapted from https://github.com/tziegmann/mcafee-jamf-extension-attributes



## MCAFEE-ISMANAGED: ##

isManaged=`sudo /Library/McAfee/agent/bin/cmdagent -i | grep GUID | cut -c 7-43`
if [ $isManaged != "N/A" ] ; 
then
result="Managed"
else
result="Unmanaged"
fi
echo $result



## MCAFEE-AGENTVERSION: ##

Version=`cat /etc/cma.d/EPOAGENT3700MACX/config.xml | egrep "<Version>.*</Version>" |sed -e "s/<Version>\(.*\)<\/Version>/\1/"|tr -d " "`
echo $Version



## MCAFEE-ANTIMALWAREVERSION: ##

engver=`/usr/bin/defaults read /Library/Preferences/com.mcafee.ssm.antimalware.plist Update_EngineVersion`
echo $engver



## MCAFEE-DATVERSION: ##

datver=`/usr/bin/defaults read /Library/Preferences/com.mcafee.ssm.antimalware.plist Update_DATVersion | cut -b 1-4`
echo $datver



## MCAFEE-FIREWALLSTATUS: ##

if [ -f "/Library/Preferences/com.mcafee.ssm.StatefulFirewall.plist" ]; then
result=`/usr/bin/defaults read /Library/Preferences/com.mcafee.ssm.StatefulFirewall IsFirewallEnabled`
fi
if [ "$result" = "1" ]; then
    echo "Enabled"
else
    echo "Disabled"
fi



## MCAFEE-LASTDATUPDATETIME: ##

if [ -f "/Library/Preferences/com.mcafee.ssm.antimalware.plist" ]; then
result=`date -r "$(/usr/bin/defaults read /Library/Preferences/com.mcafee.ssm.antimalware Update_Last_Update_Time)" "+%Y-%m-%d %H:%M:%S"`
echo $result
else
echo "Not installed"
fi



## MCAFEE-OASSTATUS: ##

result=`/usr/bin/defaults read /Library/Preferences/com.mcafee.ssm.antimalware OAS_Enable`
if [ "$result" = "1" ]; then
    echo "Enabled"
else
    echo "Disabled"
fi



## MCAFEE-AMHOTFIXVERSION: ##

AMHotfix=`cat /usr/local/McAfee/AntiMalware/var/HFSP-Version.xml | egrep "<Version0>.*</Version0>" |sed -e "s/<Version0>\(.*\)<\/Version0>/\1/"|tr -d " "|tr -d "\t"|tr -d "\n"|tr -d "\r"`
echo $AMHotfix



## MCAFEE-THREATPREVENTIONVERSION: ##

FMPVersion=`cat /usr/local/McAfee/fmp/config/FMPInfo.xml | egrep "<FMPVersion>.*</FMPVersion>" |sed -e "s/<FMPVersion>\(.*\)<\/FMPVersion>/\1/"|tr -d " "|tr -d "\t"|tr -d "\n"|tr -d "\r"`
BuildNumber=`cat /usr/local/McAfee/fmp/config/FMPInfo.xml | egrep "<BuildNumber>.*</BuildNumber>" |sed -e "s/<BuildNumber>\(.*\)<\/BuildNumber>/\1/"|tr -d " "|tr -d "\t"|tr -d "\n"|tr -d "\r"`
TPVersion="$FMPVersion.$BuildNumber"
echo $TPVersion


